pipline{
  environment {
     registry = "asadahbar/myrepo" registryCredential = 'dockerhub' dockerImage = ''
 	}
  agent any
  stages{
    stage{
      steps("chekout the code"){
	 git url: 'https://github.com/SyedAsadAhbar/Jenkins-Zero-To-Hero.git', branch: 'main'
       	}
	}
    stage{
      steps("build the application"){
	sh 'cd /java-maven-sonar-argocd-helm-k8s/spring-boot-app && mvn clean package'
	}	
	}
    stage{
      steps("test code analysis"){
	withSonarQubeEnv('My SonarQube Server') {
                sh 'mvn clean package sonar:sonar'
              }
	 }
	 }
    stage("Quality Gate") {
      steps {
              timeout(time: 1, unit: 'HOURS') {
                waitForQualityGate abortPipeline: true
              }
            }
          }
    stage{ 
      steps("build image"){
	script {dockerImage = docker.build registry + ":$BUILD_NUMBER"}}
	}
	}	
    stage{
      steps("Deploy our image"){
        script {docker.withRegistry( '', registryCredential ){
	    dockerImage.push()
	}}}}


		
	}


















}

